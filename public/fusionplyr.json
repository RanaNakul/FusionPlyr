{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "fusionplyr",
  "type": "registry:ui",
  "title": "FusionPlyr",
  "description": "A high-performance video player component with HLS support and rich features.",
  "dependencies": [
    "hls.js",
    "lucide-react"
  ],
  "files": [
    {
      "path": "ui/fusionplyr.tsx",
      "type": "registry:ui",
      "content": "\"use client\";\n\nimport React, {\n  useEffect,\n  useRef,\n  useState,\n  useCallback,\n  forwardRef,\n  useImperativeHandle,\n  type ReactNode,\n  type MouseEvent as ReactMouseEvent,\n} from \"react\";\nimport Hls, { type Level } from \"hls.js\";\nimport {\n  Play,\n  Volume1,\n  Volume2,\n  VolumeX,\n  Pause,\n  Maximize2,\n  Minimize2,\n  Settings,\n  Settings2,\n  CircleGauge,\n  MoonStar,\n  ChevronRight,\n  ChevronLeft,\n  PictureInPicture,\n  RotateCcw,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface CueRect {\n  x: number;\n  y: number;\n  w: number;\n  h: number;\n}\n\ninterface ThumbnailCue {\n  start: number;\n  end: number;\n  url?: string;\n  rect?: CueRect;\n}\n\ninterface HoverInfo {\n  show: boolean;\n  time: number;\n  x: number;\n  image: string;\n  rect: CueRect | null;\n  left: number;\n  translateX: number;\n}\n\nexport interface FusionPlayerProps {\n  src: string;\n  poster?: string;\n  timeline?: string;\n  colorScheme?: string;\n  className?: string;\n}\n\nexport interface FusionPlayerRef {\n  video: HTMLVideoElement | null;\n  container: HTMLDivElement | null;\n  play: () => Promise<void> | void;\n  pause: () => void;\n}\n\nconst formatTime = (seconds: number): string => {\n  if (isNaN(seconds)) return \"0:00\";\n  const mins = Math.floor(seconds / 60);\n  const secs = Math.floor(seconds % 60);\n  return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n};\n\nconst FusionPlyr = forwardRef<FusionPlayerRef, FusionPlayerProps>(\n  ({ src, poster, timeline, colorScheme = \"#fff\", className }, ref) => {\n    const videoRef = useRef<HTMLVideoElement>(null);\n    const rangeRef = useRef<HTMLInputElement>(null);\n    const hlsRef = useRef<Hls | null>(null);\n    const volumeRef = useRef<HTMLInputElement>(null);\n    const containerRef = useRef<HTMLDivElement>(null);\n    const sleepTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n    const lastVolumeRef = useRef<number>(0.7);\n    const volumeTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n    const speedTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n    const incrementTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n    const decrementTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n    const DEFAULT_VOLUME: number = 0.7;\n\n    const [incrementValue, setIncrementValue] = useState(0);\n    const [decrementValue, setDecrementValue] = useState(0);\n    const [showVolumeUI, setShowVolumeUI] = useState(false);\n    const [showSpeedUI, setShowSpeedUI] = useState(false);\n    const [showIncrementUI, setShowIncrementUI] = useState(false);\n    const [showDecrementUI, setShowDecrementUI] = useState(false);\n    const [showShortcuts, setShowShortcuts] = useState(false);\n    const [currentTime, setCurrentTime] = useState(0);\n    const [isCurrentTime, setIsCurrentTime] = useState(true);\n    const [duration, setDuration] = useState(1);\n    const [volume, setVolume] = useState(0.7);\n    const [isPlay, setIsPlay] = useState(false);\n    const [thumbnails, setThumbnails] = useState<ThumbnailCue[]>([]);\n    const [hoverInfo, setHoverInfo] = useState<HoverInfo>({\n      show: false,\n      time: 0,\n      x: 0,\n      image: \"\",\n      rect: null,\n      left: 0,\n      translateX: 0,\n    });\n    const [progress, setProgress] = useState(0);\n    const [qualities, setQualities] = useState<Level[]>([]);\n    const [currentQuality, setCurrentQuality] = useState(-1);\n    const [isQualityOpen, setIsQualityOpen] = useState(false);\n    const [manifestReady, setManifestReady] = useState(false);\n    const [mediaAttached, setMediaAttached] = useState(false);\n    const [sleepTime, setSleepTime] = useState(0);\n    const [cinemaMode, setCinemaMode] = useState(false);\n    const [isFullscreen, setIsFullscreen] = useState(false);\n    const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n    const [isSpeedOpen, setIsSpeedOpen] = useState(false);\n    const [currentSpeed, setCurrentSpeed] = useState(1);\n    const [isSleepTimerOpen, setIsSleepTimerOpen] = useState(false);\n\n    const isSafari =\n      typeof window !== \"undefined\" &&\n      /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\n    const parseTime = (timeStr: string): number => {\n      const parts = timeStr.split(\":\");\n      let seconds = 0;\n      if (parts.length === 3) {\n        seconds =\n          parseFloat(parts[0]) * 3600 +\n          parseFloat(parts[1]) * 60 +\n          parseFloat(parts[2]);\n      } else {\n        seconds = parseFloat(parts[0]) * 60 + parseFloat(parts[1]);\n      }\n      return seconds;\n    };\n\n    useImperativeHandle(ref, () => ({\n      video: videoRef.current,\n      container: containerRef.current,\n      play: () => videoRef.current?.play(),\n      pause: () => videoRef.current?.pause(),\n    }));\n\n    useEffect(() => {\n      if (!timeline) return;\n\n      fetch(timeline)\n        .then((res) => res.text())\n        .then((text) => {\n          const cues: ThumbnailCue[] = [];\n          const lines = text.split(\"\\n\");\n          let currentCue: Partial<ThumbnailCue> | null = null;\n\n          for (let i = 0; i < lines.length; i++) {\n            const line = lines[i].trim();\n            if (line.includes(\"-->\")) {\n              const parts = line.split(\"-->\");\n              const start = parseTime(parts[0].trim());\n              const end = parseTime(parts[1].trim());\n              currentCue = { start, end };\n            } else if (currentCue && line.startsWith(\"http\")) {\n              const [url, hash] = line.split(\"#xywh=\");\n              currentCue.url = url;\n              if (hash) {\n                const [x, y, w, h] = hash.split(\",\").map(Number);\n                currentCue.rect = { x, y, w, h };\n              }\n              cues.push(currentCue as ThumbnailCue);\n              currentCue = null;\n            }\n          }\n          setThumbnails(cues);\n        });\n    }, [timeline]);\n\n    const handleMouseMove = (e: ReactMouseEvent<HTMLInputElement>) => {\n      const rect = e.currentTarget.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const percent = Math.min(Math.max(x / rect.width, 0), 1);\n      const time = percent * duration;\n      const cue = thumbnails.find((c) => time >= c.start && time <= c.end);\n\n      let translateX = 0;\n      let left = 0;\n\n      if (cue && cue.rect) {\n        if (x >= cue.rect.w / 2) {\n          translateX = -50;\n          left = time / duration;\n        }\n\n        if (x >= rect.width - cue.rect.w / 2) {\n          left = 1;\n          translateX = -100;\n        }\n      }\n\n      setHoverInfo({\n        show: true,\n        time,\n        x: e.clientX,\n        image: cue ? cue.url || \"\" : \"\",\n        rect: cue ? cue.rect || null : null,\n        left,\n        translateX,\n      });\n    };\n\n    const showVolumeToast = useCallback(() => {\n      setShowVolumeUI(true);\n      if (volumeTimeoutRef.current) clearTimeout(volumeTimeoutRef.current);\n      volumeTimeoutRef.current = setTimeout(() => setShowVolumeUI(false), 1000);\n    }, []);\n\n    const showSpeedToast = useCallback(() => {\n      setShowSpeedUI(true);\n      if (speedTimeoutRef.current) clearTimeout(speedTimeoutRef.current);\n      speedTimeoutRef.current = setTimeout(() => setShowSpeedUI(false), 1000);\n    }, []);\n\n    const showIncrementToast = useCallback((inc: number) => {\n      setIncrementValue((prev) => prev + inc);\n      setDecrementValue(0);\n      setShowDecrementUI(false);\n      setShowIncrementUI(true);\n      if (incrementTimeoutRef.current)\n        clearTimeout(incrementTimeoutRef.current);\n      incrementTimeoutRef.current = setTimeout(() => {\n        setShowIncrementUI(false);\n        setIncrementValue(0);\n      }, 700);\n    }, []);\n\n    const showDecrementToast = useCallback((dec: number) => {\n      setDecrementValue((prev) => prev + dec);\n      setIncrementValue(0);\n      setShowIncrementUI(false);\n      setShowDecrementUI(true);\n      if (decrementTimeoutRef.current)\n        clearTimeout(decrementTimeoutRef.current);\n      decrementTimeoutRef.current = setTimeout(() => {\n        setShowDecrementUI(false);\n        setDecrementValue(0);\n      }, 700);\n    }, []);\n\n    const handlePlayPause = useCallback(async () => {\n      const video = videoRef.current;\n      if (!video) return;\n\n      if (video.paused) {\n        try {\n          await video.play();\n          setIsPlay(true);\n        } catch (err) {\n          if (err instanceof Error && err.name !== \"AbortError\")\n            console.error(err);\n        }\n      } else {\n        video.pause();\n        setIsPlay(false);\n      }\n    }, []);\n\n    useEffect(() => {\n      const video = videoRef.current;\n      if (!video) return;\n\n      if (isSafari) {\n        video.src = src;\n        return;\n      }\n\n      if (Hls.isSupported()) {\n        const hls = new Hls({\n          enableWorker: true,\n          lowLatencyMode: false,\n          backBufferLength: 90,\n        });\n\n        hlsRef.current = hls;\n        hls.loadSource(src);\n        hls.attachMedia(video);\n\n        hls.on(Hls.Events.MANIFEST_PARSED, () => {\n          setQualities(hls.levels.slice().reverse());\n          setManifestReady(true);\n        });\n\n        hls.on(Hls.Events.MEDIA_ATTACHED, () => setMediaAttached(true));\n\n        hls.on(Hls.Events.ERROR, (_, data) => {\n          if (data.fatal) {\n            if (data.type === Hls.ErrorTypes.NETWORK_ERROR) hls.startLoad();\n            else if (data.type === Hls.ErrorTypes.MEDIA_ERROR)\n              hls.recoverMediaError();\n            else hls.destroy();\n          }\n        });\n\n        return () => {\n          if (hlsRef.current) {\n            hlsRef.current.destroy();\n            hlsRef.current = null;\n          }\n        };\n      }\n    }, [src, isSafari]);\n\n    const handleQualityChange = (level: number) => {\n      const hls = hlsRef.current;\n      if (!hls || !mediaAttached || !manifestReady || !hls.media) return;\n\n      try {\n        if (level === -1) {\n          hls.currentLevel = -1;\n          hls.nextLevel = -1;\n        } else {\n          hls.currentLevel = level;\n        }\n        setCurrentQuality(level);\n      } catch (err) {\n        console.error(\"Safe quality switch blocked crash:\", err);\n      }\n    };\n\n    const handleSleepTimeChange = (val: number) => {\n      if (sleepTimeoutRef.current) {\n        clearTimeout(sleepTimeoutRef.current);\n        sleepTimeoutRef.current = null;\n      }\n      setSleepTime(val);\n      if (val === 0) return;\n\n      sleepTimeoutRef.current = setTimeout(\n        () => {\n          videoRef.current?.pause();\n          setSleepTime(0);\n          sleepTimeoutRef.current = null;\n        },\n        val * 60 * 1000,\n      );\n    };\n\n    useEffect(() => {\n      const onFsChange = () => setIsFullscreen(!!document.fullscreenElement);\n      document.addEventListener(\"fullscreenchange\", onFsChange);\n      return () => document.removeEventListener(\"fullscreenchange\", onFsChange);\n    }, []);\n\n    const toggleFullscreen = useCallback(() => {\n      if (!containerRef.current) return;\n      if (!document.fullscreenElement) {\n        containerRef.current.requestFullscreen();\n      } else {\n        document.exitFullscreen();\n      }\n    }, []);\n\n    const togglePiP = useCallback(async () => {\n      const video = videoRef.current;\n      if (!video) return;\n      try {\n        if (document.pictureInPictureElement) {\n          await document.exitPictureInPicture();\n        } else {\n          await video.requestPictureInPicture();\n        }\n      } catch (err) {\n        console.error(\"PiP toggle failed:\", err);\n      }\n    }, []);\n\n    const toggleMuted = useCallback(() => {\n      const video = videoRef.current;\n      if (!video) return;\n\n      if (video.volume === 0) {\n        video.volume = lastVolumeRef.current || 1;\n        showVolumeToast();\n      } else {\n        lastVolumeRef.current = video.volume;\n        video.volume = 0;\n        showVolumeToast();\n      }\n    }, [showVolumeToast]);\n\n    useEffect(() => {\n      const handleKeyDown = async (e: KeyboardEvent) => {\n        const target = e.target as HTMLElement;\n        if (\n          target.tagName === \"INPUT\" ||\n          target.tagName === \"TEXTAREA\" ||\n          target.isContentEditable\n        )\n          return;\n\n        const video = videoRef.current;\n        if (!video) return;\n\n        switch (e.code) {\n          case \"Space\":\n          case \"KeyK\":\n            e.preventDefault();\n            handlePlayPause();\n            break;\n          case \"KeyJ\":\n          case \"ArrowLeft\":\n            if (\n              !video ||\n              !Number.isFinite(video.duration) ||\n              !Number.isFinite(video.currentTime) ||\n              video.currentTime <= 0\n            ) {\n              break;\n            }\n            video.currentTime = Math.max(0, video.currentTime - 10);\n            showDecrementToast(10);\n            break;\n          case \"KeyL\":\n          case \"ArrowRight\":\n            if (\n              !video ||\n              !Number.isFinite(video.duration) ||\n              !Number.isFinite(video.currentTime) ||\n              video.currentTime >= video.duration - 1\n            ) {\n              break;\n            }\n            video.currentTime = Math.min(\n              video.duration - 1,\n              video.currentTime + 10,\n            );\n            showIncrementToast(10);\n            break;\n          case \"ArrowUp\":\n            e.preventDefault();\n            const volUp = Math.min(1, video.volume + 0.05);\n            video.volume = volUp;\n            setVolume(volUp);\n            if (volumeRef.current)\n              volumeRef.current.value = (volUp * 100).toString();\n            showVolumeToast();\n            break;\n          case \"ArrowDown\":\n            e.preventDefault();\n            const volDown = Math.max(0, video.volume - 0.05);\n            video.volume = volDown;\n            setVolume(volDown);\n            if (volumeRef.current)\n              volumeRef.current.value = (volDown * 100).toString();\n            showVolumeToast();\n            break;\n          case \"KeyM\":\n            toggleMuted();\n            break;\n          case \"KeyF\":\n            toggleFullscreen();\n            break;\n          case \"KeyI\":\n            togglePiP();\n            break;\n          case \"KeyT\":\n            setCinemaMode((prev) => !prev);\n            break;\n          case \"Period\":\n            if (e.shiftKey) {\n              video.playbackRate = Math.min(3, video.playbackRate + 0.25);\n              setCurrentSpeed(video.playbackRate);\n              showSpeedToast();\n            } else {\n              video.pause();\n              video.currentTime = Math.max(0, video.currentTime + 1 / 30);\n            }\n            break;\n          case \"Comma\":\n            if (e.shiftKey) {\n              video.playbackRate = Math.max(0.25, video.playbackRate - 0.25);\n              setCurrentSpeed(video.playbackRate);\n              showSpeedToast();\n            } else {\n              video.pause();\n              video.currentTime = Math.max(0, video.currentTime - 1 / 30);\n            }\n            break;\n          case \"Slash\":\n            if (e.shiftKey) setShowShortcuts(true);\n            break;\n          case \"Escape\":\n            setShowShortcuts(false);\n            break;\n          default:\n            if (e.code.startsWith(\"Digit\")) {\n              const digitValue = Number(e.code.replace(\"Digit\", \"\"));\n              const percent = digitValue * 10;\n              video.currentTime = (video.duration * percent) / 100;\n            }\n            break;\n        }\n      };\n\n      window.addEventListener(\"keydown\", handleKeyDown);\n      return () => window.removeEventListener(\"keydown\", handleKeyDown);\n    }, [\n      handlePlayPause,\n      toggleMuted,\n      toggleFullscreen,\n      togglePiP,\n      showVolumeToast,\n      showSpeedToast,\n      showIncrementToast,\n      showDecrementToast,\n    ]);\n\n    return (\n      <div\n        ref={containerRef}\n        className={cn(\n          \"relative rounded-xl mx-auto group select-none focus:outline-none bg-black overflow-hidden\",\n          cinemaMode ? \"max-w-4xl aspect-video\" : \"w-full max-w-2xl\",\n          className,\n        )}\n      >\n        {showShortcuts && (\n          <KeyboardShortcutsModal\n            open={showShortcuts}\n            onClose={() => setShowShortcuts(false)}\n          />\n        )}\n        {showVolumeUI && (\n          <div className=\"absolute top-6 left-1/2 -translate-x-1/2 z-20 flex items-center justify-center pointer-events-none\">\n            <div className=\"bg-black/60 px-4 py-2 rounded-md text-white text-lg transition-opacity duration-150 ease-out\">\n              {Math.round(volume * 100)}%\n            </div>\n          </div>\n        )}\n        {showSpeedUI && (\n          <div className=\"absolute top-6 left-1/2 -translate-x-1/2 z-20 flex items-center justify-center pointer-events-none\">\n            <div className=\"bg-black/60 px-4 py-2 rounded-md text-white text-lg transition-opacity duration-150 ease-out\">\n              {currentSpeed}x\n            </div>\n          </div>\n        )}\n\n        <div className=\"absolute top-1/2 -translate-y-1/2 right-5 z-20 flex items-center justify-center pointer-events-none\">\n          <div\n            className={cn(\n              \"flex items-center text-xl font-semibold text-white transition-all duration-150 ease-out\",\n              showIncrementUI ? \"opacity-100\" : \"opacity-0 \",\n            )}\n          >\n            {\"+\" + incrementValue}{\" \"}\n            <ChevronRight\n              className={cn(\n                \"size-8 transition-all duration-150 ease-out\",\n                showIncrementUI\n                  ? \"translate-x-0 opacity-100\"\n                  : \"-translate-x-5 opacity-0\",\n              )}\n            />\n          </div>\n        </div>\n\n        <div className=\"absolute top-1/2 -translate-y-1/2 left-5 z-20 flex items-center justify-center pointer-events-none\">\n          <div\n            className={cn(\n              \"flex items-center text-xl font-semibold text-white transition-all duration-150 ease-out\",\n              showDecrementUI ? \"opacity-100\" : \"opacity-0 \",\n            )}\n          >\n            <ChevronLeft\n              className={cn(\n                \"size-8 transition-all duration-150 ease-out\",\n                showDecrementUI\n                  ? \"translate-x-0 opacity-100\"\n                  : \"translate-x-5 opacity-0\",\n              )}\n            />{\" \"}\n            {\"-\" + decrementValue}\n          </div>\n        </div>\n\n        <button\n          onClick={() => {\n            handlePlayPause();\n            setIsSettingsOpen(false);\n            setIsQualityOpen(false);\n            setIsSpeedOpen(false);\n            setIsSleepTimerOpen(false);\n          }}\n          className=\"absolute z-10 flex items-center justify-center inset-0 select-none focus:outline-none\"\n        >\n          <div\n            className={cn(\n              \"bg-black/30 p-3 rounded-full transition-all select-none duration-300 ease-out cursor-pointer\",\n              isPlay\n                ? \"opacity-0 scale-90 pointer-events-none\"\n                : \"opacity-100 scale-100\",\n            )}\n          >\n            <Play className=\"size-10 text-white fill-white\" />\n          </div>\n        </button>\n\n        <video\n          ref={videoRef}\n          playsInline\n          preload=\"auto\"\n          poster={poster}\n          onLoadedMetadata={() => {\n            const video = videoRef.current;\n            if (!video) return;\n            video.volume = DEFAULT_VOLUME;\n            video.muted = DEFAULT_VOLUME === 0;\n            setDuration(video.duration);\n            setVolume(DEFAULT_VOLUME);\n          }}\n          onTimeUpdate={() => {\n            const video = videoRef.current;\n            if (!video) return;\n            const cur = video.currentTime;\n            setCurrentTime(cur);\n            if (duration > 0) setProgress((cur / duration) * 100);\n          }}\n          onVolumeChange={() => {\n            if (videoRef.current) setVolume(videoRef.current.volume);\n          }}\n          className=\"w-full h-full rounded-lg select-none\"\n        />\n\n        <div\n          className={cn(\n            \"absolute bottom-0 w-full flex flex-col px-3 pb-2 z-20 gap-1.5 \",\n            \"opacity-0 group-hover:opacity-100 transition-all duration-150 ease-out select-none focus:outline-none\",\n          )}\n        >\n          <div className=\"relative select-none focus:outline-none\">\n            {!isSettingsOpen && hoverInfo.show && (\n              <div\n                className=\"absolute bottom-full mb-2 flex flex-col items-center pointer-events-none z-50\"\n                style={{\n                  left: `${hoverInfo.left * 100}%`,\n                  translate: `${hoverInfo.translateX}% 0%`,\n                }}\n              >\n                {hoverInfo.image && hoverInfo.rect && (\n                  <div\n                    className=\"border border-white rounded-lg shadow-lg bg-no-repeat mb-2\"\n                    style={{\n                      backgroundImage: `url(${hoverInfo.image})`,\n                      backgroundPosition: `-${hoverInfo.rect.x}px -${hoverInfo.rect.y}px`,\n                      width: `${hoverInfo.rect.w}px`,\n                      height: `${hoverInfo.rect.h}px`,\n                    }}\n                  />\n                )}\n                <span className=\"bg-black/30 text-white text-xs px-3 py-2 rounded-full\">\n                  {formatTime(hoverInfo.time)}\n                </span>\n              </div>\n            )}\n\n            <label className=\"relative w-full group/progress h-4 flex items-center\">\n              <input\n                ref={rangeRef}\n                type=\"range\"\n                min={0}\n                max={duration}\n                value={currentTime}\n                onChange={(e) => {\n                  const val = parseFloat(e.target.value);\n                  if (videoRef.current) videoRef.current.currentTime = val;\n                  if (duration > 0) setProgress((val / duration) * 100);\n                }}\n                onMouseMove={handleMouseMove}\n                onMouseEnter={() =>\n                  setHoverInfo((prev) => ({ ...prev, show: true }))\n                }\n                onMouseLeave={() =>\n                  setHoverInfo((prev) => ({ ...prev, show: false }))\n                }\n                className=\"relative w-full cursor-pointer h-1 select-none focus:outline-none group-hover/progress:h-1.5 bg-neutral-800/80 rounded-lg appearance-none bg-no-repeat transition-[height] duration-150 [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 [&::-webkit-slider-thumb]:bg-transparent\"\n                style={{\n                  backgroundSize: `${progress}% 100%`,\n                  backgroundImage: `linear-gradient(to right, ${colorScheme}, ${colorScheme})`,\n                }}\n              />\n              <div\n                className=\"absolute top-1/2 w-3 h-3 z-30 rounded-full cursor-pointer -translate-x-1/2 -translate-y-1/2 pointer-events-none group-hover/progress:scale-[130%] group-hover/progress:shadow-md transition-transform duration-150\"\n                style={{\n                  left: `${progress}%`,\n                  backgroundColor: colorScheme,\n                }}\n              />\n            </label>\n          </div>\n\n          <div className=\"relative flex items-center justify-between\">\n            <div className=\"z-20 w-fit flex items-center gap-5\">\n              <button\n                className=\"bg-black/30 text-white py-1.5 px-1.5 rounded-full flex items-center hover:bg-neutral-600/40 font-medium text-[15px] outline-4 outline-[#0000004D] transition-all duration-150 ease-out cursor-pointer group/playpause\"\n                onClick={handlePlayPause}\n              >\n                <p className=\"w-fit bg-black/30 text-neutral-300 px-2 py-1.5 rounded-md text-xs absolute bottom-15 -left-1 font-bold group-hover/playpause:visible invisible transition-all duration-150 ease-out text-nowrap\">\n                  {isPlay ? \"Pause\" : \"Play\"}{\" \"}\n                  <span className=\"outline-neutral-400 outline px-0.75 py-px rounded-sm font-bold\">\n                    K\n                  </span>\n                </p>\n                {duration > 0 && currentTime >= duration - 0.2 ? (\n                  <RotateCcw />\n                ) : isPlay ? (\n                  <Pause className=\"fill-white\" />\n                ) : (\n                  <Play className=\"fill-white\" />\n                )}\n              </button>\n\n              <div className=\"relative w-fit flex items-center bg-black/30 py-1.5 px-1.5 rounded-full text-white hover:bg-neutral-600/40 font-medium text-[15px] outline-4 outline-[#0000004D] transition-all duration-150 ease-out cursor-pointer group/volume\">\n                <p className=\"w-fit bg-black/30 text-neutral-300 px-2 py-1.5 rounded-md text-xs absolute bottom-15 -left-3 font-bold group-hover/volume:visible invisible transition-all duration-150 ease-out text-nowrap\">\n                  {volume <= 0 ? \"Unmute\" : \"Mute\"}{\" \"}\n                  <span className=\"outline-neutral-400 outline px-0.75 py-px rounded-sm font-bold\">\n                    M\n                  </span>\n                </p>\n                <button onClick={toggleMuted} className=\"cursor-pointer\">\n                  {volume <= 0 ? (\n                    <VolumeX />\n                  ) : volume <= 0.5 ? (\n                    <Volume1 className=\"fill-white\" />\n                  ) : (\n                    <Volume2 className=\"fill-white\" />\n                  )}\n                </button>\n                <input\n                  ref={volumeRef}\n                  type=\"range\"\n                  min={0}\n                  max={100}\n                  value={volume * 100}\n                  onChange={(e) => {\n                    const val = parseFloat(e.target.value) / 100;\n                    setVolume(val);\n                    if (videoRef.current) videoRef.current.volume = val;\n                  }}\n                  className=\"w-0 h-0.5  accent-neutral-50 appearance-none bg-no-repeat bg-linear-to-r from-white to-white\n                   bg-neutral-300/30 \n                   group-hover/volume:w-15 \n                   group-hover/volume:ml-1.5  \n                   group-hover/volume:mr-1 \n                   [&::-webkit-slider-thumb]:cursor-pointer\n                   [&::-webkit-slider-thumb]:appearance-none \n                   group-hover/volume:[&::-webkit-slider-thumb]:appearance-auto\n                   transition-width duration-200 ease-in-out\"\n                  style={{ backgroundSize: `${volume * 100}% 100%` }}\n                />\n              </div>\n\n              <button\n                className=\"w-fit flex items-center gap-1 bg-black/30 py-1.5 px-4 rounded-full text-white hover:bg-neutral-600/40 font-medium text-[15px] outline-4 outline-[#0000004D] transition-all duration-150 ease-out cursor-pointer\"\n                onClick={() => setIsCurrentTime(!isCurrentTime)}\n              >\n                <div className=\"font-semibold\">\n                  {isCurrentTime\n                    ? formatTime(currentTime)\n                    : `-${formatTime(Math.max(0, duration - currentTime))}`}\n                </div>\n                <div>/</div>\n                <div>{formatTime(duration)}</div>\n              </button>\n            </div>\n\n            <div className=\"relative z-20 w-fit flex items-center bg-black/30 rounded-full text-white font-medium text-[15px] outline-4 outline-[#0000004D] cursor-pointer\">\n              <button\n                className=\"hover:bg-neutral-400/20.5 py-1.5 px-3.5 rounded-full transition-all duration-150 ease-out\"\n                onClick={() => {\n                  setIsSettingsOpen(!isSettingsOpen);\n                  setIsQualityOpen(false);\n                  setIsSpeedOpen(false);\n                  setIsSleepTimerOpen(false);\n                }}\n              >\n                <Settings\n                  className={cn(\n                    \"transition-all duration-150 ease-out\",\n                    isSettingsOpen && \"rotate-31\",\n                  )}\n                />\n              </button>\n\n              {!isFullscreen && (\n                <button\n                  onClick={() => setCinemaMode(!cinemaMode)}\n                  className=\"relative hover:bg-neutral-400/20.5 py-1.5 px-3.5 rounded-full transition-all duration-150 ease-out group/cinma select-none cursor-pointer\"\n                >\n                  <p className=\"w-fit bg-black/30 text-neutral-300 px-2 py-1.5 rounded-md text-xs absolute bottom-15 -right-7 font-bold group-hover/cinma:visible invisible transition-all duration-150 ease-out text-nowrap\">\n                    {cinemaMode ? \"Exit Cinema mode\" : \"Cinema mode\"}{\" \"}\n                    <span className=\"outline-neutral-400 outline px-0.75 py-px rounded-sm font-bold\">\n                      T\n                    </span>\n                  </p>\n                  <svg height=\"24\" viewBox=\"0 0 24 24\" width=\"24\">\n                    <path\n                      d={\n                        cinemaMode\n                          ? \"M21.20 3.01L21 3H3L2.79 3.01C2.30 3.06 1.84 3.29 1.51 3.65C1.18 4.02 .99 4.50 1 5V19L1.01 19.20C1.05 19.66 1.26 20.08 1.58 20.41C1.91 20.73 2.33 20.94 2.79 20.99L3 21H21L21.20 20.98C21.66 20.94 22.08 20.73 22.41 20.41C22.73 20.08 22.94 19.66 22.99 19.20L23 19V5C23.00 4.50 22.81 4.02 22.48 3.65C22.15 3.29 21.69 3.06 21.20 3.01ZM3 15V5H21V15H3ZM16.87 6.72H16.86L16.79 6.79L13.58 10L16.79 13.20C16.88 13.30 16.99 13.37 17.11 13.43C17.23 13.48 17.37 13.51 17.50 13.51C17.63 13.51 17.76 13.48 17.89 13.43C18.01 13.38 18.12 13.31 18.21 13.21C18.31 13.12 18.38 13.01 18.43 12.89C18.48 12.76 18.51 12.63 18.51 12.50C18.51 12.37 18.48 12.23 18.43 12.11C18.37 11.99 18.30 11.88 18.20 11.79L16.41 10L18.20 8.20L18.27 8.13C18.42 7.93 18.50 7.69 18.49 7.45C18.47 7.20 18.37 6.97 18.20 6.79C18.02 6.62 17.79 6.52 17.55 6.50C17.30 6.49 17.06 6.57 16.87 6.72ZM5.79 6.79C5.60 6.98 5.50 7.23 5.50 7.5C5.50 7.76 5.60 8.01 5.79 8.20L7.58 10L5.79 11.79L5.72 11.86C5.57 12.06 5.49 12.30 5.50 12.54C5.51 12.79 5.62 13.02 5.79 13.20C5.97 13.37 6.20 13.48 6.45 13.49C6.69 13.50 6.93 13.42 7.13 13.27L7.20 13.20L10.41 10L7.20 6.79C7.01 6.60 6.76 6.50 6.5 6.50C6.23 6.50 5.98 6.60 5.79 6.79ZM3 19V17H21V19H3Z\"\n                          : \"M21.20 3.01L21 3H3L2.79 3.01C2.30 3.06 1.84 3.29 1.51 3.65C1.18 4.02 .99 4.50 1 5V19L1.01 19.20C1.05 19.66 1.26 20.08 1.58 20.41C1.91 20.73 2.33 20.94 2.79 20.99L3 21H21L21.20 20.98C21.66 20.94 22.08 20.73 22.41 20.41C22.73 20.08 22.94 19.66 22.99 19.20L23 19V5C23.00 4.50 22.81 4.02 22.48 3.65C22.15 3.29 21.69 3.06 21.20 3.01ZM3 15V5H21V15H3ZM7.87 6.72L7.79 6.79L4.58 10L7.79 13.20C7.88 13.30 7.99 13.37 8.11 13.43C8.23 13.48 8.37 13.51 8.50 13.51C8.63 13.51 8.76 13.48 8.89 13.43C9.01 13.38 9.12 13.31 9.21 13.21C9.31 13.12 9.38 13.01 9.43 12.89C9.48 12.76 9.51 12.63 9.51 12.50C9.51 12.37 9.48 12.23 9.43 12.11C9.37 11.99 9.30 11.88 9.20 11.79L7.41 10L9.20 8.20L9.27 8.13C9.42 7.93 9.50 7.69 9.48 7.45C9.47 7.20 9.36 6.97 9.19 6.80C9.02 6.63 8.79 6.52 8.54 6.51C8.30 6.49 8.06 6.57 7.87 6.72ZM14.79 6.79C14.60 6.98 14.50 7.23 14.50 7.5C14.50 7.76 14.60 8.01 14.79 8.20L16.58 10L14.79 11.79L14.72 11.86C14.57 12.06 14.49 12.30 14.50 12.54C14.51 12.79 14.62 13.02 14.79 13.20C14.97 13.37 15.20 13.48 15.45 13.49C15.69 13.50 15.93 13.42 16.13 13.27L16.20 13.20L19.41 10L16.20 6.79C16.01 6.60 15.76 6.50 15.5 6.50C15.23 6.50 14.98 6.60 14.79 6.79ZM3 19V17H21V19H3Z\"\n                      }\n                      fill=\"white\"\n                    />\n                  </svg>\n                </button>\n              )}\n\n              <button\n                onClick={togglePiP}\n                className=\"relative hover:bg-neutral-400/20.5 py-1.5 px-3.5 rounded-full transition-all duration-150 ease-out group/pip cursor-pointer\"\n              >\n                <p className=\"w-fit bg-black/30 text-neutral-300 px-2 py-1.5 rounded-md text-xs absolute bottom-15 -right-10 font-bold group-hover/pip:visible invisible transition-all duration-150 ease-out text-nowrap\">\n                  Picture in Picture{\" \"}\n                  <span className=\"outline-neutral-400 outline px-0.75 py-px rounded-sm font-bold\">\n                    I\n                  </span>\n                </p>\n                <PictureInPicture />\n              </button>\n\n              <button\n                onClick={toggleFullscreen}\n                className=\"relative hover:bg-neutral-400/20.5 py-1.5 px-3.5 rounded-full transition-all duration-150 ease-out group/fullscreen cursor-pointer\"\n              >\n                <p className=\"w-fit bg-black/30 text-neutral-300 px-2 py-1.5 rounded-md text-xs absolute bottom-15 right-0 font-bold group-hover/fullscreen:visible invisible transition-all duration-150 ease-out text-nowrap\">\n                  {isFullscreen ? \"Exit Full Screen\" : \"Full Screen\"}{\" \"}\n                  <span className=\"outline-neutral-400 outline px-0.75 py-px rounded-sm font-bold\">\n                    F\n                  </span>\n                </p>\n                {isFullscreen ? (\n                  <Minimize2 className=\"rotate-90\" />\n                ) : (\n                  <Maximize2 className=\"rotate-90\" />\n                )}\n              </button>\n            </div>\n          </div>\n\n          {/* settings menu */}\n          <div\n            className={cn(\n              \"absolute bottom-16 right-2 flex flex-col items-center bg-black/50 rounded-lg p-2 font-medium text-sm transition-all duration-150 ease-out origin-bottom-right\",\n              isSettingsOpen\n                ? \"w-70 opacity-100 pointer-events-auto\"\n                : \"w-65 opacity-0 pointer-events-none\",\n            )}\n          >\n            <button\n              className=\"flex items-center justify-between gap-2 w-full hover:bg-neutral-400/20.5 py-3 px-1.5 rounded-lg transition-all duration-150 ease-out\"\n              onClick={() => {\n                setIsSleepTimerOpen(true);\n                setIsSettingsOpen(false);\n              }}\n            >\n              <div className=\"flex items-center gap-4\">\n                <MoonStar className=\"size-5\" />\n                <p className=\"text-neutral-300\">Sleep timer</p>\n              </div>\n              <div className=\"flex items-center gap-1 text-neutral-400\">\n                <div>{sleepTime === 0 ? \"Off\" : `${sleepTime} min`}</div>\n                <ChevronRight className=\"size-4.5\" />\n              </div>\n            </button>\n            <button\n              className=\"flex items-center justify-between gap-2 w-full hover:bg-neutral-400/20.5 py-3 px-1.5 rounded-lg transition-all duration-150 ease-out\"\n              onClick={() => {\n                setIsSpeedOpen(true);\n                setIsSettingsOpen(false);\n              }}\n            >\n              <div className=\"flex items-center gap-4\">\n                <CircleGauge className=\"size-5\" />\n                <p className=\"text-neutral-300\">Playback speed</p>\n              </div>\n              <div className=\"flex items-center gap-1 text-neutral-400\">\n                <div>{currentSpeed}x</div>\n                <ChevronRight className=\"size-4.5\" />\n              </div>\n            </button>\n            <button\n              className=\"flex items-center justify-between gap-2 w-full hover:bg-neutral-400/20.5 py-3 px-1.5 rounded-lg transition-all duration-150 ease-out\"\n              onClick={() => {\n                setIsQualityOpen(true);\n                setIsSettingsOpen(false);\n              }}\n            >\n              <div className=\"flex items-center gap-4\">\n                <Settings2 className=\"size-5\" />\n                <p className=\"text-neutral-300\">Quality</p>\n              </div>\n              <div className=\"flex items-center gap-1 text-neutral-400\">\n                <div>\n                  {currentQuality === -1\n                    ? \"Auto\"\n                    : qualities.find(\n                        (_, i) => qualities.length - 1 - i === currentQuality,\n                      )?.height + \"p\"}\n                </div>\n                <ChevronRight className=\"size-4.5\" />\n              </div>\n            </button>\n          </div>\n\n          {/* quality menu */}\n          <div\n            className={cn(\n              \"absolute bottom-16 right-2 flex flex-col items-center bg-black/50 rounded-lg py-2 font-medium text-sm transition-all duration-150 ease-out origin-bottom-right\",\n              isQualityOpen\n                ? \"w-50 opacity-100 pointer-events-auto\"\n                : \"w-40 opacity-0 pointer-events-none\",\n            )}\n          >\n            <div className=\"w-full pt-2 pb-4 border-b border-white/20 px-2 mb-2\">\n              <button\n                onClick={() => {\n                  setIsQualityOpen(false);\n                  setIsSettingsOpen(true);\n                }}\n                className=\"flex items-center gap-2 cursor-pointer\"\n              >\n                <ChevronLeft className=\"size-5 text-white\" />\n                <p>Quality</p>\n              </button>\n            </div>\n            <div className=\"w-full px-2\">\n              {qualities.map((level, index) => {\n                const isPremium = level.bitrate.toString() === \"8231300\";\n                const isActive =\n                  currentQuality === qualities.length - 1 - index;\n                return (\n                  <button\n                    key={index}\n                    disabled={isSafari || !manifestReady || !mediaAttached}\n                    onClick={() =>\n                      handleQualityChange(qualities.length - 1 - index)\n                    }\n                    className={cn(\n                      \"w-full text-left px-6 py-2 rounded-lg transition-all duration-150 ease-out disabled:opacity-40 disabled:pointer-events-none\",\n                      isActive\n                        ? \"bg-neutral-400/30\"\n                        : \"hover:bg-neutral-400/20\",\n                    )}\n                  >\n                    {level.height}p\n                    {isPremium && (\n                      <>\n                        <br />\n                        <span className=\"text-xs text-neutral-400\">\n                          Premium Bitrate\n                        </span>\n                      </>\n                    )}\n                  </button>\n                );\n              })}\n              <button\n                disabled={isSafari || !manifestReady || !mediaAttached}\n                onClick={() => handleQualityChange(-1)}\n                className={cn(\n                  \"w-full text-left px-6 py-2 rounded-lg transition-all duration-150 ease-out disabled:opacity-40 disabled:pointer-events-none\",\n                  currentQuality === -1\n                    ? \"bg-neutral-400/30\"\n                    : \"hover:bg-neutral-400/20\",\n                )}\n              >\n                Auto\n              </button>\n            </div>\n          </div>\n\n          {/* playback speed menu */}\n          <div\n            className={cn(\n              \"absolute bottom-16 right-2 flex flex-col items-center h-70 bg-black/50 rounded-lg pt-2 font-medium text-sm transition-all duration-150 ease-out overflow-y-auto origin-bottom-right [scrollbar-width:thin] [scrollbar-color:rgba(255,255,255,0.25)_transparent]\",\n              isSpeedOpen\n                ? \"w-50 opacity-100 pointer-events-auto\"\n                : \"w-40 opacity-0 pointer-events-none\",\n            )}\n          >\n            <div className=\"w-full pt-2 pb-4 border-b border-white/20 px-2\">\n              <button\n                onClick={() => {\n                  setIsSpeedOpen(false);\n                  setIsSettingsOpen(true);\n                }}\n                className=\"flex items-center gap-2 cursor-pointer\"\n              >\n                <ChevronLeft className=\"size-5 text-white\" />\n                <p>Playback Speed</p>\n              </button>\n            </div>\n            <div className=\"w-full flex flex-col p-2\">\n              {[0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 2.5, 3].map(\n                (speed, index) => (\n                  <button\n                    key={index}\n                    onClick={() => {\n                      setCurrentSpeed(speed);\n                      if (videoRef.current)\n                        videoRef.current.playbackRate = speed;\n                    }}\n                    className={cn(\n                      \"w-full text-left px-6 py-2 rounded-lg transition-all duration-150 ease-out\",\n                      currentSpeed === speed\n                        ? \"bg-neutral-400/30\"\n                        : \"hover:bg-neutral-400/20\",\n                    )}\n                  >\n                    {speed}x\n                  </button>\n                ),\n              )}\n            </div>\n          </div>\n\n          {/* sleep timer menu */}\n          <div\n            className={cn(\n              \"absolute bottom-16 right-2 flex flex-col items-center h-70 bg-black/50 rounded-lg pt-2 font-medium text-sm transition-all duration-150 ease-out overflow-y-auto [scrollbar-width:thin] [scrollbar-color:rgba(255,255,255,0.25)_transparent]\",\n              isSleepTimerOpen\n                ? \"w-50 opacity-100 pointer-events-auto\"\n                : \"w-40 opacity-0 pointer-events-none\",\n            )}\n          >\n            <div className=\"w-full pt-2 pb-4 border-b border-white/20 px-2 \">\n              <button\n                onClick={() => {\n                  setIsSleepTimerOpen(false);\n                  setIsSettingsOpen(true);\n                }}\n                className=\"flex items-center gap-2 cursor-pointer\"\n              >\n                <ChevronLeft className=\"size-5 text-white\" />\n                <p>Sleep Timer</p>\n              </button>\n            </div>\n            <div className=\"w-full flex flex-col p-2\">\n              {[0, 1, 5, 10, 15, 20, 25, 30].map((time, index) => (\n                <button\n                  key={index}\n                  onClick={() => handleSleepTimeChange(time)}\n                  className={cn(\n                    \"w-full text-left px-6 py-2 rounded-lg transition-all duration-150 ease-out\",\n                    sleepTime === time\n                      ? \"bg-neutral-400/30\"\n                      : \"hover:bg-neutral-400/20\",\n                  )}\n                >\n                  {time === 0 ? \"Off\" : `${time} min`}\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  },\n);\n\nFusionPlyr.displayName = \"FusionPlyr\";\n\nexport { FusionPlyr };\n\ninterface ShortcutItem {\n  label: string;\n  keys: string[];\n}\n\ninterface ShortcutSectionType {\n  section: string;\n  items: ShortcutItem[];\n}\n\nconst playback: ShortcutSectionType = {\n  section: \"Playback\",\n  items: [\n    { label: \"Play / Pause\", keys: [\"Space\", \"K\"] },\n    { label: \"Rewind 10 seconds\", keys: [\"J\", \"←\"] },\n    { label: \"Fast forward 10 seconds\", keys: [\"L\", \"→\"] },\n    { label: \"Previous frame (paused)\", keys: [\",\"] },\n    { label: \"Next frame (paused)\", keys: [\".\"] },\n    { label: \"Decrease playback rate\", keys: [\"Shift + ,\"] },\n    { label: \"Increase playback rate\", keys: [\"Shift + .\"] },\n    { label: \"Seek to specific point\", keys: [\"0\", \"–\", \"9\"] },\n  ],\n};\n\nconst audio: ShortcutSectionType = {\n  section: \"Audio\",\n  items: [\n    { label: \"Toggle mute\", keys: [\"M\"] },\n    { label: \"Volume up\", keys: [\"↑\"] },\n    { label: \"Volume down\", keys: [\"↓\"] },\n  ],\n};\n\nconst view: ShortcutSectionType = {\n  section: \"View\",\n  items: [\n    { label: \"Toggle theatre mode\", keys: [\"T\"] },\n    { label: \"Toggle fullscreen\", keys: [\"F\"] },\n    { label: \"Toggle Picture-in-Picture\", keys: [\"I\"] },\n    { label: \"Close dialog / exit\", keys: [\"Esc\"] },\n  ],\n};\n\nfunction Key({ children }: { children: ReactNode }) {\n  return (\n    <kbd className=\"min-w-[28px] px-2 py-0.5 text-center rounded border border-neutral-600 bg-neutral-800 text-xs font-medium text-neutral-200\">\n      {children}\n    </kbd>\n  );\n}\n\nfunction ShortcutRow({ label, keys }: ShortcutItem) {\n  return (\n    <div className=\"flex items-center justify-between py-2 border-b border-neutral-800 last:border-none\">\n      <span className=\"text-sm text-neutral-300\">{label}</span>\n\n      <div className=\"flex items-center gap-1\">\n        {keys.map((key, i) => (\n          <Key key={i}>{key}</Key>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction ShortcutSection({ section, items }: ShortcutSectionType) {\n  return (\n    <div>\n      <h3 className=\"mb-3 text-xs font-semibold uppercase tracking-wide text-neutral-400\">\n        {section}\n      </h3>\n\n      <div className=\"rounded-lg bg-neutral-900 px-4\">\n        {items.map((item, i) => (\n          <ShortcutRow key={i} {...item} />\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction KeyboardShortcutsModal({\n  open,\n  onClose,\n}: {\n  open: boolean;\n  onClose: () => void;\n}) {\n  if (!open) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n      <div\n        className=\"fixed inset-0 bg-black/70 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n      <div\n        className=\"relative  w-full max-w-4xl max-h-[80vh] overflow-y-auto rounded-xl bg-neutral-950 p-6 shadow-2xl\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <header className=\"mb-6 flex items-center justify-between\">\n          <h2 className=\"text-lg font-semibold text-white\">\n            Keyboard shortcuts\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"text-sm text-red-800 hover:text-red-500 font-medium  transition-colors duration-150 ease-out\"\n          >\n            Esc\n          </button>\n        </header>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n          <div className=\"mb-6\">\n            {playback && <ShortcutSection {...playback} />}\n          </div>\n\n          <div className=\"space-y-3\">\n            {audio && <ShortcutSection {...audio} />}\n            {view && <ShortcutSection {...view} />}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
    }
  ]
}
